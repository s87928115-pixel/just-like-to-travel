<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>滑雪不跌倒 2025</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        muji: {
                            bg: '#F9F8F6',
                            card: '#FFFFFF',
                            text: '#333333',
                            primary: '#7F6B5D',
                            accent: '#6B8E23',
                            border: '#E0E0D8'
                        }
                    },
                    fontFamily: {
                        sans: ['"Noto Sans TC"', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background-color: #F9F8F6;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            font-size: 18px;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .animate-fade-in { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^19.2.1",
    "react-dom": "https://esm.sh/react-dom@^19.2.1",
    "react-dom/client": "https://esm.sh/react-dom@^19.2.1/client",
    "lucide-react": "https://esm.sh/lucide-react@^0.559.0",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/"
  }
}
</script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect, useMemo } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Calendar, Utensils, Wallet, CheckSquare, Info, Snowflake, 
            MapPin, ArrowRight, Plane, Image as ImageIcon, X, Camera, 
            Clock, Train, Upload, Trash, ShoppingBag, Sparkles, Loader2, 
            ShoppingCart, Home, MoreHorizontal, Eraser, Globe, ExternalLink,
            ChevronDown, ChevronRight, Luggage, QrCode, Building, Hash, TriangleAlert,
            Square, Car, Plus, ThumbsUp, Sun, Cloud, CloudRain
        } from 'lucide-react';

        const ITINERARY_DATA = [
            { day: 1, date: "2/24 (一)", loc: "東京/輕井澤", items: [
                { time: "06:40", title: "酷航 TR898 出發", desc: "第一航廈報到", type: "transport" },
                { time: "10:45", title: "抵達成田機場", desc: "入境、拿行李", type: "transport" },
                { time: "11:13+", title: "成田機場 -> 上野 (Skyliner)", desc: "時刻表:\n11:13 | Skyliner 22號\n11:33 | Skyliner 24號\n11:53 | Skyliner 26號\n12:13 | Skyliner 28號", type: "transport" },
                { time: "午餐", title: "上野午餐", desc: "推薦：蟹食放題 / 炸豬排 / 天婦羅", type: "meal" },
                { time: "15:10", title: "上野 -> 輕井澤 (新幹線)", desc: "時刻表:\n15:10 | Hakutaka 567\n15:30 | Asama 619\n15:50 | Hakutaka 569", type: "transport" },
                { time: "16:30", title: "租雪具", desc: "地址：4-8 Karuizawahigashi", map: "4-8 Karuizawahigashi, Karuizawa, Nagano", type: "activity" },
                { time: "住宿", title: "輕井澤王子飯店西館", map: "輕井澤町輕井澤1016-85", type: "hotel" }
            ]},
            { day: 2, date: "2/25 (二)", loc: "輕井澤", items: [
                { time: "全日", title: "滑雪 Day 1", desc: "小心安全，滑雪不跌倒！", type: "activity" }
            ]},
            { day: 3, date: "2/26 (三)", loc: "輕井澤", items: [
                { time: "09:00", title: "滑雪 Day 2", desc: "滑到 16:00 結束", type: "activity" },
                { time: "17:00", title: "租車", desc: "準備自駕行程", type: "transport" }
            ]},
            { day: 4, date: "2/27 (四)", loc: "輕井澤/東京", items: [
                { time: "09:30", title: "榆樹街小鎮", desc: "逛街、買伴手禮", type: "activity" },
                { time: "11:00", title: "雲場池", desc: "散步拍照", type: "activity" },
                { time: "13:57+", title: "輕井澤 -> 上野 (新幹線)", type: "transport" },
                { time: "住宿", title: "LANDABOUT TOKYO", type: "hotel" }
            ]},
            { day: 5, date: "2/28 (五)", loc: "東京/山形", items: [
                { time: "09:30", title: "妙義神社", type: "activity" },
                { time: "14:00", title: "上野 -> 新庄 (新幹線)", type: "transport" },
                { time: "住宿", title: "Route Inn 新莊站前", type: "hotel" }
            ]},
            { day: 6, date: "3/1 (六)", loc: "山形/仙台", items: [
                { time: "09:00", title: "最上川遊船", desc: "欣賞雪景", type: "activity" },
                { time: "13:18", title: "新庄 -> 仙台 (新幹線)", type: "transport" },
                { time: "住宿", title: "The OneFive Sendai", type: "hotel" }
            ]},
            { day: 7, date: "3/2 (日)", loc: "仙台/山寺", items: [
                { time: "08:18", title: "仙台 -> 山寺", type: "transport" },
                { time: "Plan B", title: "自駕採果", type: "activity" }
            ]},
            { day: 8, date: "3/3 (一)", loc: "仙台", items: [
                { time: "09:30", title: "瑞鳳殿", type: "activity" },
                { time: "18:30", title: "肉十八", desc: "晚餐：燒肉吃到飽", type: "meal" }
            ]},
            { day: 9, date: "3/4 (二)", loc: "宮城/山形", items: [
                { time: "10:30", title: "狐狸村", map: "Miyagi Shiroishi", desc: "抱狐狸體驗", type: "activity" },
                { time: "15:15", title: "藏王樹冰", type: "activity" },
                { time: "住宿", title: "Route Inn Yamagataminami", type: "hotel" }
            ]},
            { day: 10, date: "3/5 (三)", loc: "山形/宮城", items: [
                { time: "10:40", title: "銀山溫泉", type: "activity" },
                { time: "16:00", title: "松島海岸", type: "activity" },
                { time: "住宿", title: "The OneFive Sendai", type: "hotel" }
            ]},
            { day: 11, date: "3/6 (四)", loc: "仙台/返台", items: [
                { time: "11:30", title: "AEON MALL", type: "activity" },
                { time: "17:25", title: "星宇航空 JX863", type: "transport" }
            ]}
        ];

        const FOOD_DATA = [
            { day: "上野美食", items: [
                { name: "蟹食放題 ごっつお", addr: "東京都文京區湯島", url: "https://www.hotpepper.jp/strJ001210630/", desc: "紅楚蟹吃到飽！" },
                { name: "東京炸豬排 がぶう", addr: "東京都台東區上野", desc: "厚切炸豬排。" }
            ]},
            { day: "輕井澤美食", items: [
                { name: "村民食堂", addr: "長野縣輕井澤町", desc: "星野區必吃。" }
            ]}
        ];

        const CATEGORIZED_PACKING_LIST = {
            "重要物品": ["護照", "信用卡", "現金", "國際駕照"],
            "滑雪裝備": ["雪鏡", "排汗衣", "雪襪", "雪手套", "屁墊"],
            "日常衣物": ["羽絨外套", "帽子", "太陽眼鏡", "發熱衣"]
        };

        const formatMoney = (num) => new Intl.NumberFormat('en-US').format(num);
        const getMapLink = (query) => `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`;
        const processImage = (file, callback) => {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const MAX_WIDTH = 600;
                    const scale = MAX_WIDTH / img.width;
                    canvas.width = MAX_WIDTH;
                    canvas.height = img.height * scale;
                    const ctx = canvas.getContext('2d');
                    ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                    callback(canvas.toDataURL('image/jpeg', 0.7));
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        };

        const PlanView = () => {
            const [activeDayIdx, setActiveDayIdx] = useState(0);
            const [coverImg, setCoverImg] = useState(localStorage.getItem('planCoverImg'));
            const [itemImages, setItemImages] = useState(JSON.parse(localStorage.getItem('itineraryItemImages') || '{}'));

            const handleCoverUpload = (e) => {
                const file = e.target.files?.[0];
                if (file) processImage(file, (base64) => { setCoverImg(base64); localStorage.setItem('planCoverImg', base64); });
            };

            const handleItemPhotoUpload = (day, itemIdx, e) => {
                const file = e.target.files?.[0];
                if (file) processImage(file, (base64) => {
                    const updated = { ...itemImages, [`${day}-${itemIdx}`]: base64 };
                    setItemImages(updated);
                    localStorage.setItem('itineraryItemImages', JSON.stringify(updated));
                });
            };

            const dayData = ITINERARY_DATA[activeDayIdx];

            const getWeatherInfo = (loc) => {
                if (loc.includes('輕井澤')) return { icon: Snowflake, temp: '-2°C / 4°C', color: 'text-blue-400' };
                if (loc.includes('山形')) return { icon: Snowflake, temp: '-4°C / 2°C', color: 'text-blue-500' };
                if (loc.includes('東京')) return { icon: Sun, temp: '5°C / 12°C', color: 'text-orange-400' };
                if (loc.includes('仙台')) return { icon: Cloud, temp: '0°C / 7°C', color: 'text-gray-400' };
                return { icon: Cloud, temp: '--', color: 'text-gray-300' };
            };
            const weather = getWeatherInfo(dayData.loc);

            return (
                <div className="pt-[140px] pb-24 px-4 space-y-8 animate-fade-in" key={activeDayIdx}>
                    <div className="fixed top-[70px] left-0 w-full bg-[#F9F8F6]/95 z-40 overflow-x-auto no-scrollbar py-4 px-4 border-b border-muji-border flex gap-3">
                        {ITINERARY_DATA.map((day, idx) => (
                            <button key={idx} onClick={() => setActiveDayIdx(idx)} className={`whitespace-nowrap px-7 py-3 rounded-full font-black text-base shadow-sm transition-all ${activeDayIdx === idx ? 'bg-muji-primary text-white scale-105' : 'bg-white text-gray-400 border'}`}>
                                Day {day.day}
                            </button>
                        ))}
                    </div>

                    <div className="relative">
                        {coverImg ? (
                            <div className="relative group">
                                <img src={coverImg} className="w-full h-56 object-cover rounded-3xl shadow-lg" />
                                <label className="absolute bottom-4 right-4 bg-white/90 px-4 py-2 rounded-xl text-base font-black shadow-md cursor-pointer"><Camera size={18} className="inline mr-2"/>換封面<input type="file" accept="image/*" className="hidden" onChange={handleCoverUpload}/></label>
                            </div>
                        ) : (
                            <label className="w-full h-40 bg-white border-2 border-dashed rounded-3xl flex flex-col items-center justify-center text-gray-400 cursor-pointer shadow-sm">
                                <ImageIcon size={32} className="mb-2"/><span className="text-base font-black">設定封面</span><input type="file" accept="image/*" className="hidden" onChange={handleCoverUpload}/></label>
                        )}
                    </div>

                    <div className="flex justify-between items-end border-b-4 border-muji-primary/10 pb-4">
                        <div><h2 className="text-4xl font-black text-muji-primary">DAY {dayData.day}</h2><p className="text-lg text-gray-500 font-bold">{dayData.date}</p></div>
                        <div className="text-right flex flex-col items-end gap-2">
                            <div className="bg-muji-accent text-white px-5 py-2 rounded-2xl text-base font-black shadow-md">{dayData.loc}</div>
                            <div className="flex items-center gap-2 bg-white px-3 py-1.5 rounded-xl border border-gray-100 shadow-sm text-sm font-black text-gray-600">
                                <weather.icon size={18} className={weather.color} /> {weather.temp}
                            </div>
                        </div>
                    </div>

                    <div className="border-l-4 border-muji-border ml-3 space-y-10">
                        {dayData.items.map((item, idx) => {
                            const itemPhoto = itemImages[`${dayData.day}-${idx}`];
                            return (
                                <div key={idx} className="relative pl-10">
                                    <div className="absolute -left-[13px] top-2 w-6 h-6 rounded-full bg-muji-bg border-4 border-muji-accent z-10 shadow-sm"></div>
                                    <div className="bg-white rounded-3xl p-6 shadow-md border border-gray-50 relative">
                                        <div className="flex justify-between items-start mb-3">
                                            <div className="flex items-center gap-2 text-muji-accent font-black text-xl">{item.type === 'transport' ? <Train size={22}/> : <Clock size={22}/>}{item.time}</div>
                                            <div className="flex gap-3">
                                                <label className="text-gray-300 hover:text-muji-primary cursor-pointer"><Upload size={20}/><input type="file" accept="image/*" className="hidden" onChange={(e)=>handleItemPhotoUpload(dayData.day, idx, e)}/></label>
                                                {item.map && <a href={getMapLink(item.map)} target="_blank" className="text-muji-primary"><MapPin size={22}/></a>}
                                            </div>
                                        </div>
                                        <div className="font-black text-2xl text-muji-text mb-3">{item.title}</div>
                                        {item.desc && <div className="text-lg text-gray-700 leading-relaxed">{item.desc}</div>}
                                        {itemPhoto && <img src={itemPhoto} className="mt-5 w-full h-48 object-cover rounded-2xl border" />}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };

        const FoodView = () => (
            <div className="pt-24 pb-24 px-4 space-y-8 animate-fade-in text-center">
                <h2 className="text-4xl font-black text-muji-primary">美食導覽</h2>
                {FOOD_DATA.map((sec, i) => (
                    <div key={i} className="text-left space-y-4">
                        <div className="bg-muji-primary text-white py-2 px-6 rounded-xl font-black text-xl inline-block">{sec.day}</div>
                        {sec.items.map((item, j) => (
                            <div key={j} className="bg-white rounded-3xl p-6 shadow-md border border-gray-50 relative">
                                <h4 className="font-black text-2xl mb-2">{item.name}</h4>
                                <p className="text-base text-gray-500 mb-3 flex items-center gap-2"><MapPin size={16}/>{item.addr}</p>
                                {item.desc && <div className="text-lg text-gray-700 font-medium bg-orange-50/50 p-4 rounded-2xl">{item.desc}</div>}
                            </div>
                        ))}
                    </div>
                ))}
            </div>
        );

        const WalletView = () => (
            <div className="pt-24 pb-24 px-4 space-y-8 animate-fade-in text-center">
                <h2 className="text-4xl font-black text-muji-primary">記帳工具</h2>
                <div className="bg-white p-10 rounded-3xl shadow-md border text-lg font-black text-gray-400">目前尚無紀錄</div>
            </div>
        );

        const ListsView = () => (
            <div className="pt-24 pb-24 px-4 space-y-8 animate-fade-in text-center">
                <h2 className="text-4xl font-black text-muji-primary">行李清單</h2>
                {Object.entries(CATEGORIZED_PACKING_LIST).map(([cat, items]) => (
                    <div key={cat} className="text-left space-y-4">
                        <div className="bg-muji-primary/10 text-muji-primary py-2 px-6 rounded-xl font-black text-xl inline-block">{cat}</div>
                        <div className="grid gap-3">
                            {items.map(i => (
                                <div key={i} className="bg-white p-5 rounded-2xl border flex items-center gap-4 text-xl font-bold">
                                    <Square className="text-gray-200" size={24} /> {i}
                                </div>
                            ))}
                        </div>
                    </div>
                ))}
            </div>
        );

        const InfoView = () => (
            <div className="pt-24 pb-24 px-4 space-y-8 animate-fade-in text-center">
                <h2 className="text-4xl font-black text-muji-primary">旅遊資訊</h2>
                <div className="bg-white p-8 rounded-3xl shadow-md border space-y-4 text-left">
                    <h3 className="text-2xl font-black flex items-center gap-2 text-indigo-500"><Building size={24}/> 飯店清單</h3>
                    <p className="text-lg text-gray-600 font-bold">請確認確認碼與地點。</p>
                </div>
            </div>
        );

        const App = () => {
            const [activeTab, setActiveTab] = useState('plan');
            const renderContent = () => {
                switch (activeTab) {
                    case 'plan': return <PlanView />;
                    case 'food': return <FoodView />;
                    case 'wallet': return <WalletView />;
                    case 'lists': return <ListsView />;
                    case 'info': return <InfoView />;
                }
            };
            const NavBtn = ({ tab, icon: Icon, label }) => (
                <button onClick={() => { setActiveTab(tab); window.scrollTo(0, 0); }} className={`flex flex-col items-center justify-center w-full py-2 transition-all ${activeTab === tab ? 'text-muji-primary scale-110' : 'text-gray-400'}`}>
                    <Icon size={28} className="mb-1" /><span className="text-sm font-black">{label}</span>
                </button>
            );
            return (
                <div className="min-h-screen bg-[#F9F8F6]">
                    <header className="fixed top-0 w-full bg-[#F9F8F6]/95 backdrop-blur-md z-50 border-b h-[80px] flex justify-between items-center px-6 shadow-sm">
                        <h1 className="text-3xl font-black text-muji-primary flex items-center gap-3">滑雪不跌倒 <Snowflake size={32} className="animate-pulse text-blue-300"/></h1>
                        <div className="text-base text-gray-500 font-black uppercase">{new Date().toLocaleDateString()}</div>
                    </header>
                    <main>{renderContent()}</main>
                    <nav className="fixed bottom-0 w-full bg-white border-t z-50 pb-[env(safe-area-inset-bottom)] shadow-lg">
                        <div className="flex justify-between items-center h-[80px] px-2">
                            <NavBtn tab="plan" icon={Calendar} label="行程" />
                            <NavBtn tab="food" icon={Utensils} label="美食" />
                            <NavBtn tab="wallet" icon={Wallet} label="記帳" />
                            <NavBtn tab="lists" icon={CheckSquare} label="清單" />
                            <NavBtn tab="info" icon={Info} label="資訊" />
                        </div>
                    </nav>
                </div>
            );
        };

        const container = document.getElementById('root');
        const root = createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
